{"version":3,"sources":["index.js"],"names":["os","require","inquirer","cli","enable","async","fs","PUBNUB","slug","shelljs","envs","packageInfo","Networking","Logger","setApp","version","parse","block","key","file","env","email","insert","password","loglevel","workingDir","String","pwd","main","args","options","tasks","blockFile","sessionFile","homedir","info","userQuestions","name","message","type","validate","input","result","indexOf","self","session","blockLocal","blockRemote","eventHandler","blockFileRequired","logger","logLevel","api","endpoint","host","fatal","ok","mergeEventHandler","data","debug","_id","id","event","channels","output","updateEventHandler","revise","cb","o","default","choices","qs","Object","keys","forEach","hasOwnProperty","push","length","eventHandlerName","error","prompt","then","mergeBlock","_key_id","key_id","description","updateBlock","restore","updateSessionToken","token","blockCreate","subscribe_key","publish_key","createBlock","keyId","blockPayload","err","payload","explain","opts","b","k","f","hint","command","sessionFileGet","readJson","sessionDelete","unlink","sessionGet","login","args2","spinner","createLoginToken","stringifyNetworkingError","outputJson","spaces","err2","answers","expires","Date","getTime","user","requireInit","blockRead","blockFileCreate","keyGet","givenKey","getApps","ownerId","paramKey","app","value","Separator","value2","properties","blockGet","givenBlock","createcb","getBlocks","paramBlock","blockWrite","blockPush","blockPushArgs","blockId","blockStart","startBlock","pubnub","init","origin","chan","realtime_analytics_channel","subscribe","channel","m","state","JSON","stringify","blockStop","stopBlock","eventHandlerGet","paramEventHandler","event_handlers","eventHandlerWrite","eachSeries","eh","holla","fullPath","noIds","found","appendEH","outputFile","code","i","index","blockComplete","eventHandlerComplete","mapSeries","results","eventHandlerPush","update","done","eventHandlerId","eventHandlerPayload","block_id","createEventHandler","each","testJson","readFile","existsSync","testVars","readFileSync","replace","routes","functions","success","logout","pull","start","stop","series","process","exit"],"mappings":"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","file":"index.js","sourcesContent":["const os = require('os'); // os level functions\n\nconst inquirer = require('inquirer'); // interactive mode selection\nconst cli = require('cli').enable('status'); // Enable cli.ok, cli.error, etc\nconst async = require('async'); // async control flow\nconst fs = require('fs-extra'); // json support for fs\nconst PUBNUB = require('pubnub'); // obviously\nconst slug = require('slug'); // strips characters for friendly file names\nconst shelljs = require('shelljs'); // ability to run shell commands\n\nconst envs = require('./../envs'); // location of block environment configs\nconst packageInfo = require('./../package');\nconst Networking = require('./networking');\nconst Logger = require('./utils/logger');\n\n// enable plugins\ncli.enable('version');\n\n// configure self reporting.\ncli.setApp('PubNub CLI', packageInfo.version);\n\n// cli arguments and commands\ncli.parse({\n  block: ['b', 'Block ID', 'int'],\n  key: ['k', 'Subscribe Key ID', 'int'],\n  file: ['f', 'A block file', 'path'],\n  env: ['e', 'An environment [bronze, silver, gold, prod]', 'string'],\n  email: ['m', 'Email', 'string'],\n  insert: ['n', 'Insert Mode. Create new blocks and skip prompts.', true, false],\n  password: ['p', 'Password', 'string'],\n  loglevel: [false, 'set logging verbosity (info, debug)', 'string', 'info'],\n}, ['login', 'logout', 'start', 'stop', 'init', 'push', 'pull']);\n\n// sets all file operations relative to the current directory\nconst workingDir = String(shelljs.pwd() + '/');\n\n// cli function to parse arguments and options\ncli.main(function (args, options) {\n  options.file = options.file || '/';\n\n  // an array of functions to run through in series\n  // search for the string 'routes' in your IDE for more info\n  const tasks = [];\n\n  // default file location is pwd\n  const blockFile = workingDir + options.file + 'block.json';\n\n  // token and user info stored in home directory as this file\n  const sessionFile = os.homedir() + '/.pubnub-cli';\n\n  if (options.insert) {\n    cli.info('Warning! Insert option provided.');\n    cli.info('Creating new blocks and skipping prompts.');\n  }\n\n  // user login questions for inquirer\n  const userQuestions = {\n    email: {\n      name: 'email',\n      message: 'PubNub Email:',\n      type: 'input',\n      validate(input) {\n        let result = true;\n\n        if (input.indexOf('@') === -1) { // I apologize\n          result = 'Please enter a valid email address.';\n        }\n\n        return result;\n      }\n    },\n    password: {\n      name: 'password',\n      message: 'PubNub Password:',\n      type: 'password'\n    }\n  };\n\n  const self = this;\n\n  // methods in this object are pushed into the ```tasks``` array\n  // then those methods are executed in series\n  // as the methods execute, they populate properties of this object\n  // these properties may be accessed by functions executed later\n\n  self.session = false; // the user session\n  self.blockLocal = false; // the local block file\n  self.blockRemote = false; // the remove block json object\n  self.key = false; // the selected key object\n  self.eventHandler = false; // the selected event handler object\n\n  self.blockFileRequired = false;\n\n  // specify the required environment\n  options.env = options.env || 'prod';\n\n  self.env = envs[options.env]; // map the env string to an object\n\n  const logger = new Logger({ logLevel: options.loglevel });\n\n  // pubnub-api is a custom api client for portal related operations\n  const api = new Networking({ logger }, { endpoint: self.env.host });\n\n  if (!self.env) {\n    cli.fatal('Invalid environment');\n  } else {\n    cli.ok('Working with ' + options.env + ' environment at ' + self.env.host);\n  }\n\n  // this merges a remote event handler with a local event handler\n  const mergeEventHandler = function (input, data) {\n    cli.debug('Merging remote event handle with local event handler.');\n\n    input._id = data.id || input._id;\n    input.name = data.name || input.name;\n    input.event = data.event || input.event;\n    input.channels = data.channels || input.channels;\n    input.file = input.file || data.file; // local attribute wins\n    input.output = data.output || input.output;\n\n    return input;\n  };\n\n  // interactive mode of creating/updating/merging an event handler\n  const updateEventHandler = function (eventHandler, revise, cb) {\n    // questions for inquirer\n    const o = {\n      name: {\n        name: 'name',\n        message: 'Name:',\n        type: 'input',\n        default: eventHandler.name\n      },\n      event: {\n        name: 'event',\n        message: 'Event:',\n        type: 'list',\n        default: eventHandler.event,\n        choices: ['js-after-publish', 'js-before-publish',\n          'js-after-presence'\n        ]\n      },\n      channels: {\n        name: 'channels',\n        message: 'PubNub Channels:',\n        type: 'input',\n        default: eventHandler.channels\n      },\n      output: {\n        name: 'output',\n        message: 'Output:',\n        type: 'input',\n        default: eventHandler.output\n      }\n    };\n\n    // if we're missing this property\n    // add interactive question to an array\n    const qs = [];\n    Object.keys(o).forEach((key) => {\n      if (revise || !eventHandler.hasOwnProperty(key)) {\n        qs.push(o[key]);\n      }\n    });\n\n    if (qs.length) {\n      // if there are questions, prompt the user\n      if (!revise) {\n        const eventHandlerName = eventHandler.name || eventHandler.event || 'Unknown';\n        cli.error('Event handler ' + eventHandlerName + ' is missing some information.');\n      }\n\n      inquirer.prompt(qs).then(cb);\n    } else {\n      // otherwise, return\n      cb(eventHandler);\n    }\n  };\n\n  // merges a remote block with what exists on the local filesystem\n  const mergeBlock = function (input, data) {\n    cli.debug('Merging remote block with local block.');\n\n    input._id = data.id || input._id;\n    input._key_id = data.key_id || input._key_id;\n    input.name = data.name || input.name;\n    input.description = data.description || input.description;\n\n    return input;\n  };\n\n  // updates a block object with information from interactive mode\n  const updateBlock = function (block, revise, cb) {\n    // questions for inquirer\n    const o = {\n      name: {\n        name: 'name',\n        message: 'Name:',\n        type: 'input',\n        default: block.name\n      },\n      description: {\n        name: 'description',\n        message: 'Description:',\n        type: 'input',\n        default: block.description\n      }\n    };\n\n    // if the block does not have the property\n    // add the prompt to a list of questions\n    const qs = [];\n    Object.keys(o).forEach((key) => {\n      if (revise || !block.hasOwnProperty(key)) {\n        qs.push(o[key]);\n      }\n    });\n\n    if (qs.length) {\n      // if we need to prompt, feed the list to interactive mode\n      if (!revise) {\n        cli.error('Block.json is missing some information.');\n      }\n\n      inquirer.prompt(qs).then(cb);\n    } else {\n      // otherwise just return\n      cb(block);\n    }\n  };\n\n  // update the pubnub-api lib with the local sessions\n  const restore = function (session, cb) {\n    api.updateSessionToken(session.token);\n    cb(null, session);\n  };\n\n  const blockCreate = function (key, cb) {\n    updateBlock(self.blockLocal, !options.insert, (block) => {\n      block.key_id = key.id;\n      block.subscribe_key = key.subscribe_key;\n      block.publish_key = key.publish_key;\n\n      api.createBlock({ keyId: key.id, blockPayload: block }, (err, data) => {\n        cli.ok('Block Created');\n        cb(err ? err.message : null, data.payload);\n      });\n    });\n  };\n\n  // OK: Use this handy command next time:\n  // OK: pubnub-cli push -b 1130 -k 145183\n  const explain = function () {\n    const opts = {};\n\n    // checks for the presence of object properties and informs users\n    // that they can use relevant args as a shortcut\n    if (self.blockRemote) {\n      opts.b = self.blockRemote.id;\n    }\n    if (self.key) {\n      opts.k = self.key.id;\n    }\n    if (options.file && options.file !== '/') {\n      opts.f = options.file;\n    }\n\n    if (Object.keys(opts).length) {\n      let hint = 'pubnub-cli ' + cli.command;\n\n      Object.keys(opts).forEach((key) => {\n        hint = hint + ' -' + key + ' ' + opts[key];\n      });\n\n      cli.ok('Use this handy command next time:');\n      cli.ok(hint);\n    }\n  };\n\n  // restores session from local file\n  self.sessionFileGet = function (cb) {\n    cli.debug('sessionFileGet');\n\n    // see if session file exists\n    cli.info('Reading session from ' + sessionFile);\n    fs.readJson(sessionFile, (err, session) => {\n      if (err) {\n        cb(null);\n      } else {\n        self.session = session;\n        cb(null);\n      }\n    });\n  };\n\n  // deletes the local session file\n  self.sessionDelete = function (cb) {\n    cli.debug('delete_settings');\n\n    if (!self.session) {\n      cli.error('You are not logged in.');\n    } else {\n      cli.info('Deleting session from ' + sessionFile);\n      fs.unlink(sessionFile, (err) => {\n        if (err) {\n          cb(err);\n        } else {\n          cb();\n        }\n      });\n    }\n  };\n\n  // uses the local session file to login\n  self.sessionGet = function (cb) {\n    cli.debug('get_user');\n\n    const login = function (args2) {\n      cli.spinner('Logging In...');\n\n      api.createLoginToken(args2, (err, data) => {\n        cli.spinner('', true);\n\n        if (err) return cli.error(self.stringifyNetworkingError(err));\n\n        cli.info('Writing session to ' + sessionFile);\n        fs.outputJson(sessionFile, data.result, { spaces: 4 }, (err2) => {\n          self.session = data.result;\n          api.updateSessionToken(data.result.token);\n          cb(err2);\n        });\n      });\n    };\n\n    if (!self.session) {\n      if (cli.command !== 'login') {\n        cli.error('No session found, please log in.');\n      }\n\n      if (options.email || options.password) {\n        if (options.email && options.password) {\n          login({ email: options.email, password: options.password }, cb);\n        } else {\n          cli.error('You must supply both email and password to login.');\n        }\n      } else {\n        // no file found, prompt for user and pass\n        inquirer.prompt([userQuestions.email, userQuestions.password]).then((answers) => {\n          login(answers, cb);\n        });\n      }\n    } else {\n      // we have the session file\n      if (self.session.expires > (new Date().getTime() / 1000)) {\n        cli.ok('Working as ' + self.session.user.email);\n\n        // token is not expired, tell api to restore\n        restore(self.session, cb);\n      } else {\n        // token expired, need to login again\n        cli.error('Session has expired, please login.');\n\n        // supply email, prompt password\n        inquirer.prompt([userQuestions.password]).then((answers) => {\n          answers.email = self.session.user.email;\n          login(answers, cb);\n        });\n      }\n    }\n  };\n\n  // this is a shortcut to require a block.json is supplied\n  self.requireInit = function (cb) {\n    self.blockFileRequired = true;\n    cb();\n  };\n\n  // reads a block.json from wokring dir and sets as self.blockLocal\n  self.blockRead = function (cb) {\n    cli.debug('blockRead');\n\n    cli.info('Reading block.json from ' + blockFile);\n    fs.readJson(blockFile, (err, data) => {\n      if (err) {\n        if (self.blockFileRequired) {\n          cli.info('No block.json found.' +\n            ' Please run pubnub-cli init.');\n        } else {\n          cb(null);\n        }\n      } else {\n        if (data.name) {\n          cli.ok('Working on block ' + data.name);\n        }\n        self.blockLocal = data;\n        cb();\n      }\n    });\n  };\n\n  // creates a block.json in working dir\n  self.blockFileCreate = function (cb) {\n    cli.debug('blockFileCreate');\n\n    cli.info('Checking for block.json in ' + blockFile);\n    fs.readJson(blockFile, (err, data) => {\n      if (data) {\n        cli.info('Block.json already exists.... editing');\n        cb();\n      } else {\n        cli.info('Writing block.json to ' + blockFile);\n        fs.outputJson(blockFile, {}, {\n          spaces: 4\n        }, cb);\n      }\n    });\n  };\n\n  // sets self.key\n  self.keyGet = function (cb) {\n    cli.debug('keyGet');\n\n    // looks first in options, then in remote block, then local block\n    const givenKey = options.key || self.blockRemote.key_id || self.blockLocal._key_id;\n\n    api.getApps({ ownerId: self.session.user.id }, (err, data) => {\n      if (err) return cli.error(self.stringifyNetworkingError(err));\n\n      // if key is supplied through cli or file\n      if (givenKey) {\n        // we need to map the key id to the key object\n        let paramKey = false;\n\n        data.result.forEach((app) => {\n          app.keys.forEach((value) => {\n            if (givenKey === value.id) {\n              paramKey = value;\n            }\n          });\n        });\n\n        if (!paramKey) {\n          cb('Invalid key ID');\n        } else {\n          self.key = paramKey;\n          cb(err);\n        }\n      } else {\n        // create an interactive key selection\n        const choices = [];\n\n        // loop through apps\n        data.result.forEach((value) => {\n          choices.push(new inquirer.Separator('---' + value.name));\n\n          // loop through keys in app\n          value.keys.forEach((value2) => {\n            choices.push({\n              name: value2.properties.name || value2.subscribe_key,\n              value: value2\n            });\n          });\n        });\n\n        cli.ok('Which app are you working on?');\n\n        inquirer.prompt([{ type: 'list', name: 'key', message: 'Select a key', choices }]).then((answers) => {\n          self.key = answers.key;\n          cb(err);\n        });\n      }\n    });\n  };\n\n  // gets a remote block and sets as self.blockRemote\n  self.blockGet = function (cb) {\n    cli.debug('block');\n\n    // look for the key in options\n    // then remote block, then local block\n    const givenBlock = options.block || self.blockRemote.id || self.blockLocal._id;\n\n    const createcb = function () {\n      blockCreate(self.key, (err2, data) => {\n        self.blockRemote = data;\n        cb(err2);\n      });\n    };\n\n    api.getBlocks({ keyId: self.key.id }, (err, result) => {\n      if (err) {\n        cb(err);\n      } else {\n        // if we force upsert, forget prompts\n        if (options.insert) {\n          createcb();\n        } else if (givenBlock) {\n          // if block is supplied through cli\n          let paramBlock = false;\n\n          result.payload.forEach((value) => {\n            if (givenBlock === value.id) {\n              paramBlock = value;\n            }\n          });\n\n          if (!paramBlock) {\n            cb('Invalid block ID');\n          } else {\n            self.blockRemote = paramBlock;\n            cb(null);\n          }\n        } else {\n          // choose block with gui\n          const choices = [];\n          choices.push(new inquirer.Separator('--- Admin'));\n\n          choices.push({\n            name: 'Create a New Block',\n            value: false\n          });\n\n          if (result.payload.length) {\n            choices.push(new inquirer.Separator('--- Blocks'));\n\n            result.payload.forEach((value) => {\n              choices.push({ name: value.name, value });\n            });\n          }\n\n          cli.ok('Which block are you working on?');\n\n          inquirer.prompt([{ type: 'list', name: 'block', message: 'Select a block', choices }]).then((answers) => {\n            if (!answers.block) {\n              createcb();\n            } else {\n              self.blockRemote = answers.block;\n              cb(null);\n            }\n          });\n        }\n      }\n    });\n  };\n\n  // writes block to the local file\n  self.blockWrite = function (cb) {\n    cli.debug('blockWrite');\n\n    // if for some reason blockLocal has key_id, remove it\n    if (self.blockLocal.key_id) {\n      delete self.blockLocal.key_id;\n    }\n\n    self.blockLocal._key_id = self.key.id;\n    self.blockLocal._id = self.blockRemote.id;\n    self.blockLocal.name = self.blockRemote.name;\n    self.blockLocal.description = self.blockRemote.description;\n\n    cli.info('Writing block.json to ' + blockFile);\n    fs.outputJson(blockFile, self.blockLocal, { spaces: 4 }, cb);\n  };\n\n  // pushes self.blockLocal to endpoint\n  self.blockPush = function (cb) {\n    cli.debug('blockPush');\n\n    const blockPushArgs = {\n      keyId: self.blockRemote.key_id,\n      blockId: self.blockRemote.id,\n      blockPayload: self.blockLocal\n    };\n\n    api.updateBlock(blockPushArgs, (err) => {\n      cb(err ? err.message : null);\n    });\n  };\n\n  // starts block on pubnub server\n  self.blockStart = function (cb) {\n    cli.debug('blockStart');\n\n    api.startBlock({ keyId: self.blockLocal._key_id, blockId: self.blockLocal._id }, () => {\n      cli.ok('Sending Start Command');\n\n      // after it starts\n      // we need to subscribe to the channel to see output\n      const pubnub = PUBNUB.init({\n        subscribe_key: self.key.subscribe_key,\n        publish_key: self.key.publish_key,\n        origin: self.env.origin\n      });\n\n      // the channel is crazy\n      const chan = 'blocks-state-' +\n        self.key.properties.realtime_analytics_channel +\n        '.' + self.blockLocal._id;\n\n      cli.info('Subscribing to blocks status channel...');\n\n      // show a loading spinner\n      cli.spinner('Starting Block...');\n\n      // subscribe to status channel\n      pubnub.subscribe({\n        channel: chan,\n        message(m) {\n          if (m.state === 'running') {\n            cli.spinner('Starting Block... OK', true);\n            cli.ok('Block State: ' + m.state);\n            cb();\n          } else if (m.state === 'stopped') {\n            cli.ok('Block State: ' + m.state);\n            cb();\n          } else {\n            if (m.state !== 'pending') {\n              cli.info('Block State: ' + m.state + '...');\n            }\n          }\n        },\n        error(error) {\n          // Handle error here\n          cb(JSON.stringify(error));\n        }\n      });\n    });\n  };\n\n  // issue block stop request on server\n  self.blockStop = function (cb) {\n    cli.debug('blockStop');\n\n    api.stopBlock({ keyId: self.blockLocal._key_id, blockId: self.blockLocal._id }, (err) => {\n      cb(err);\n    });\n  };\n\n  // get event handler from server and set as self.eventHandler\n  self.eventHandlerGet = function (cb) {\n    cli.debug('eventHandler');\n\n    // if event is supplied through cli\n    if (options.eventHandler) {\n      let paramEventHandler = false;\n\n      self.blockRemote.event_handlers.forEach((value) => {\n        if (options.eventHandler === value.id) {\n          paramEventHandler = value;\n        }\n      });\n\n      if (!paramEventHandler) {\n        cb('Invalid event handler ID');\n      } else {\n        self.eventHandler = paramEventHandler;\n        cb(null);\n      }\n    } else {\n      const choices = [];\n\n      self.blockRemote.event_handlers.forEach((value) => {\n        choices.push({ name: value.name, value });\n      });\n\n      cli.ok('Which event handler?');\n\n      const message = 'Select an event handler';\n      inquirer.prompt([{ type: 'list', name: 'eventHandler', message, choices }]).then((answers) => {\n        self.eventHandler = answers.eventHandler;\n        cb(null);\n      });\n    }\n  };\n\n  self.stringifyNetworkingError = function (err) {\n    return err.message;\n  };\n\n  // write the event handler to a js file within a directory\n  self.eventHandlerWrite = function (cb) {\n    cli.debug('eventHandlerWrite');\n\n    self.blockLocal.event_handlers = self.blockLocal.event_handlers || [];\n\n    // for each server event handler\n    async.eachSeries(self.blockRemote.event_handlers, (eh, holla) => {\n      cli.info('Working on ' + eh.name);\n\n      eh.file = eh.event + '/' + slug(eh.name) + '.js';\n      const fullPath = workingDir + options.file + eh.file;\n\n      // try to find event handler with same id\n      const noIds = []; // count the number of eh with no id\n\n      let found = false;\n\n      self.blockLocal.event_handlers.forEach((value) => {\n        // if ids match\n        // overwrite local with what we have on server\n        if (eh.id === value._id) {\n          found = true;\n          value = mergeEventHandler(value, eh);\n        }\n\n        // find event handlers on server that do not exist locally\n        if (!value._id) {\n          noIds.push(value);\n        }\n      });\n\n      // writes an event handler to disk\n      const appendEH = function () {\n        cli.info('Writing event handler to ' + fullPath);\n        fs.outputFile(fullPath, eh.code, () => {\n          cli.debug('writing eventHandler');\n          self.blockLocal.event_handlers.push(mergeEventHandler({}, eh));\n          holla();\n        });\n      };\n\n      // if server event handler exists and no match found\n      if (!found) {\n        // if all the existing eh in the file have ids\n        if (!noIds.length) {\n          // write the file and push\n          appendEH();\n        } else {\n          cli.error('There is a remote event handler that does not have a local link.');\n          cli.error('Does this (server) event handler match a (local) event handler?');\n\n          cli.info('Event Handler Name: ' + eh.name);\n          cli.info('Event Handler Description: ' + eh.description);\n\n          const choices = [];\n\n          choices.push(new inquirer.Separator('--- Select'));\n\n          let i = 0;\n          self.blockLocal.event_handlers.forEach((value) => {\n            choices.push({ name: value.name, value: { index: i, value } });\n            i += 1;\n          });\n\n          choices.push(new inquirer.Separator('--- Create'));\n\n          choices.push({ name: 'Create a new event handler', value: false });\n\n          cli.info('prompt');\n\n          inquirer.prompt([{\n            type: 'list',\n            name: 'eh',\n            message: 'Which event handler is this?',\n            choices\n          }]).then((answers) => {\n            if (!answers.eh) {\n              appendEH();\n            } else {\n              mergeEventHandler(\n                self.blockLocal.event_handlers[\n                  answers.eh.index], eh);\n              holla(null);\n            }\n          });\n        }\n      }\n    },\n      () => {\n        cli.debug('Writing event handlers to block.json to ' + blockFile);\n        fs.outputJson(blockFile, self.blockLocal, { spaces: 4 }, cb);\n      }\n    );\n  };\n\n  // ensures that all properties exist within block.json\n  self.blockComplete = function (cb) {\n    cli.debug('ensuring block in block.json is complete');\n\n    updateBlock(self.blockLocal, false, (data) => {\n      self.blockLocal = mergeBlock(self.blockLocal, data);\n\n      cli.debug('Writing block.json to ' + blockFile);\n      fs.outputJson(blockFile, self.blockLocal, { spaces: 4 }, cb);\n    });\n  };\n\n  // ensures that all needed properties exist within eventHandler\n  self.eventHandlerComplete = function (cb) {\n    cli.debug('ensuring event handler in block.json is complete');\n\n    async.mapSeries(self.blockLocal.event_handlers, (eh, holla) => {\n      updateEventHandler(eh, false, (data) => {\n        holla(null, mergeEventHandler(eh, data));\n      });\n    }, (err, results) => {\n      self.blockLocal.event_handlers = results;\n\n      cli.debug('Writing block.json in' + blockFile);\n      fs.outputJson(blockFile, self.blockLocal, { spaces: 4 }, cb);\n    });\n  };\n\n  // uploads the event handler to the server\n  self.eventHandlerPush = function (cb) {\n    cli.debug('eventHandlerPush');\n\n    const update = function (data, done) {\n      const id = data._id;\n\n      // these properties don't exist on server, so don't send them\n      delete data._id;\n      if (data.file) {\n        delete data.file;\n      }\n\n      if (id) {\n        // if id exists, update (put)\n        api.updateEventHandler({ keyId: self.blockRemote.key_id, eventHandlerId: id, eventHandlerPayload: data }, done);\n      } else {\n        // of id does not exist (update)\n        data.block_id = self.blockRemote.id;\n        data.key_id = self.blockRemote.key_id;\n        data.type = 'js';\n\n        api.createEventHandler({ keyId: self.blockRemote.key_id, eventHandlerPayload: data }, done);\n      }\n    };\n\n    // update all event handlers supplies in block.json\n    async.each(self.blockLocal.event_handlers, (eh, holla) => {\n      if (eh.file) {\n        const fullPath = workingDir + options.file + eh.file;\n        const testJson = workingDir + options.file + 'test.json';\n\n        cli.info('Uploading event handler from ' + fullPath);\n        fs.readFile(fullPath, 'utf8', (err, data) => {\n          if (err) {\n            holla(err.message);\n          } else {\n            // internal use only\n            // see if there's a test.json in directory\n            if (fs.existsSync(testJson)) {\n              // replace placeholder vars with those\n              // in test.json if so\n              const testVars = JSON.parse(fs.readFileSync(testJson, 'utf8'));\n\n              // do the actual replacing\n              Object.keys(testVars).forEach((key) => {\n                data = data.replace(key, testVars[key]);\n              });\n            }\n\n            eh.code = data;\n\n            update(eh, holla);\n          }\n        });\n      } else {\n        update(eh, holla);\n      }\n    }, cb);\n  };\n\n  // this is an array of routes\n  // each route matches a possible command supplies through the cli\n  // ```functions``` is an array of methods that are executed in order\n  // ```success``` is the message displayed\n  // when all methods have been executed\n  const routes = {\n    login: {\n      functions: ['sessionFileGet', 'sessionGet'],\n      success: 'Logged In!'\n    },\n    logout: {\n      functions: ['sessionFileGet', 'sessionDelete'],\n      success: 'Logged Out'\n    },\n    init: {\n      functions: ['sessionFileGet', 'sessionGet',\n        'blockFileCreate', 'blockRead', 'keyGet', 'blockGet',\n        'blockWrite', 'eventHandlerWrite'\n      ],\n      success: 'New block.json written to disk.'\n    },\n    push: {\n      functions: ['sessionFileGet', 'sessionGet', 'blockRead',\n        'keyGet', 'blockGet', 'blockComplete',\n        'eventHandlerComplete', 'eventHandlerPush',\n        'blockPush'\n      ],\n      success: 'Block pushed'\n    },\n    pull: {\n      functions: ['sessionFileGet', 'sessionGet', 'requireInit',\n        'blockRead', 'keyGet', 'blockGet', 'blockWrite',\n        'eventHandlerWrite'\n      ],\n      success: 'Local block.json updated with remote data.'\n    },\n    start: {\n      functions: ['sessionFileGet', 'sessionGet', 'blockRead', 'keyGet', 'blockStart'],\n      success: 'Block started'\n    },\n    stop: {\n      functions: ['sessionFileGet', 'sessionGet', 'blockRead', 'blockStop'],\n      success: 'Block stopped'\n    }\n  };\n\n  // this is the magic function that creates a function queue\n  // using the supplied CLI command\n  routes[cli.command].functions.forEach((value) => {\n    tasks.push(self[value]);\n  });\n\n  // async series is used to execute the commands in series\n  // if one function fails, the process immediately returns\n  // and displays an error\n  async.series(tasks, (err) => {\n    if (err) {\n      cli.error(self.stringifyNetworkingError(err));\n    } else {\n      // otherwise, display the given success message\n      cli.ok('---------------------------------------');\n      if (routes[cli.command].success) {\n        cli.ok(routes[cli.command].success);\n      }\n      cli.ok('---------------------------------------');\n\n      // display the 'use this command next time' message\n      explain();\n\n      // forceful exit\n      process.exit(0);\n    }\n  });\n\n  return self;\n});\n"],"sourceRoot":"/source/"}