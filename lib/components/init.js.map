{"version":3,"sources":["components/init.js"],"names":["VERSION","logger","networking","interactive","blockManifestFile","folderPath","error","existingManifest","readFileSync","join","e","red","inputParams","field","name","question","type","default","kebabCase","basename","then","fields","info","JSON","stringify","prompt","message","result","okayToWrite","dependencies","version","writeFileSync","srcFolder","templateFolder","__dirname","jsTemplate","statSync","mkdirSync","validate","input","trim","length","choices","handlerJSON","lowerCase"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;AAEA;;;;;;AAEA,IAAMA,UAAU,CAAhB;;;AAIE,wBAAyD;AAAA,QAA3CC,MAA2C,QAA3CA,MAA2C;AAAA,QAAnCC,UAAmC,QAAnCA,UAAmC;AAAA,gCAAvBC,WAAuB;AAAA,QAAvBA,WAAuB,oCAAT,KAAS;;AAAA;;AACvD,SAAKF,MAAL,GAAcA,MAAd;AACA,SAAKC,UAAL,GAAkBA,UAAlB;AACA,SAAKC,WAAL,GAAmBA,WAAnB;AACA,SAAKC,iBAAL,GAAyB,YAAzB;AACD;;;;uCAE2B;AAAA;;AAAA,UAAdC,UAAc,SAAdA,UAAc;;AAE1B,UAAI,CAAC,KAAKF,WAAV,EAAuB;AACrB,aAAKF,MAAL,CAAYK,KAAZ,CAAkB,qDAAlB;AACA;AACD;;AAED,UAAIC,mBAAmB,IAAvB;;AAEA,UAAI;AACFA,2BAAmB,aAAGC,YAAH,CAAgB,eAAKC,IAAL,CAAUJ,UAAV,EAAsB,KAAKD,iBAA3B,CAAhB,EAA+D,OAA/D,CAAnB;AACD,OAFD,CAEE,OAAOM,CAAP,EAAU,CAEX;;AAED,UAAIH,qBAAqB,IAAzB,EAA+B;AAC7B,aAAKN,MAAL,CAAYK,KAAZ,CAAkB,eAAOK,GAAP,CAAW,KAAKP,iBAAL,GAAyB,wCAApC,CAAlB;AACA;AACD;;AAED,UAAMQ,cAAc,CAClB;AACEC,eAAO,IADT;AAEEC,cAAM,MAFR;AAGEC,kBAAU,6BAHZ;AAIEC,cAAM,OAJR;AAKEC,iBAAS,iBAAEC,SAAF,CAAY,eAAKC,QAAL,CAAcd,UAAd,CAAZ;AALX,OADkB,EAQlB;AACEQ,eAAO,IADT;AAEEC,cAAM,aAFR;AAGEC,kBAAU,oCAHZ;AAIEC,cAAM;AAJR,OARkB,EAclB;AACEH,eAAO,IADT;AAEEC,cAAM,SAFR;AAGEC,kBAAU,+BAHZ;AAIEC,cAAM,OAJR;AAKEC,iBAAS;AALX,OAdkB,EAqBlB;AACEJ,eAAO,IADT;AAEEC,cAAM,SAFR;AAGEC,kBAAU,iCAHZ;AAIEC,cAAM,OAJR;AAKEC,iBAAS;AALX,OArBkB,CAApB;;AA8BA,sCAAoBL,WAApB,EAAiC,KAAKT,WAAtC,EAAmDiB,IAAnD,CAAwD,UAACC,MAAD,EAAY;AAClE,cAAKpB,MAAL,CAAYqB,IAAZ,CAAiB,mCAAmC,MAAKlB,iBAAxC,GAA4D,UAA5D,GAAyEmB,KAAKC,SAAL,CAAeH,MAAf,EAAuB,IAAvB,EAA6B,IAA7B,CAA1F;;AAEA,2BAASI,MAAT,CAAgB,EAAET,MAAM,SAAR,EAAmBF,MAAM,aAAzB,EAAwCG,SAAS,IAAjD,EAAuDS,SAAS,+BAAhE,EAAhB,EAAmHN,IAAnH,CAAwH,UAACO,MAAD,EAAY;AAClI,cAAIA,OAAOC,WAAX,EAAwB;AACtBP,mBAAOQ,YAAP,GAAsB,EAAtB;AACAR,mBAAOS,OAAP,GAAiB9B,OAAjB;AACA,yBAAG+B,aAAH,CAAiB,eAAKtB,IAAL,CAAUJ,UAAV,EAAsB,MAAKD,iBAA3B,CAAjB,EAAgEmB,KAAKC,SAAL,CAAeH,MAAf,EAAuB,IAAvB,EAA6B,CAA7B,CAAhE;AACA,kBAAKpB,MAAL,CAAYqB,IAAZ,CAAiB,MAAKlB,iBAAL,GAAyB,mBAAzB,GAA+C,eAAKK,IAAL,CAAUJ,UAAV,EAAsB,MAAKD,iBAA3B,CAAhE;AACD;AACF,SAPD;AAQD,OAXD;AAYD;;;8CAEkC;AAAA;;AAAA,UAAdC,UAAc,SAAdA,UAAc;;AACjC,UAAM2B,YAAY,eAAKvB,IAAL,CAAUJ,UAAV,EAAsB,KAAtB,CAAlB;AACA,UAAM4B,iBAAiB,eAAKxB,IAAL,CAAUyB,SAAV,EAAqB,iBAArB,CAAvB;AACA,UAAMC,aAAa,aAAG3B,YAAH,CAAgB,eAAKC,IAAL,CAAUwB,cAAV,EAA0B,OAA1B,CAAhB,EAAoD,MAApD,CAAnB;;AAGA,UAAI,CAAC,KAAK9B,WAAV,EAAuB;AACrB,aAAKF,MAAL,CAAYK,KAAZ,CAAkB,4DAAlB;AACA;AACD;;AAGD,UAAI;AACF,qBAAG8B,QAAH,CAAYJ,SAAZ;AACD,OAFD,CAEE,OAAOtB,CAAP,EAAU;AACV,qBAAG2B,SAAH,CAAaL,SAAb;AACD;;AAED,UAAMpB,cAAc,CAClB;AACEC,eAAO,IADT;AAEEC,cAAM,MAFR;AAGEC,kBAAU,qCAHZ;AAIEC,cAAM,OAJR;AAKEsB,kBAAU,kBAACC,KAAD,EAAW;AAAE,iBAAQA,UAAU,EAAV,IAAgB,iBAAEC,IAAF,CAAOD,KAAP,EAAcE,MAAd,GAAuB,CAA/C;AAAoD;AAL7E,OADkB,EAQlB;AACE5B,eAAO,IADT;AAEEC,cAAM,MAFR;AAGEC,kBAAU,sCAHZ;AAIEC,cAAM,MAJR;AAKE0B,iBAAS,CAAC,gBAAD,EAAmB,eAAnB,EAAoC,gBAApC;AALX,OARkB,CAApB;;AAiBA,sCAAoB9B,WAApB,EAAiC,KAAKT,WAAtC,EAAmDiB,IAAnD,CAAwD,UAACC,MAAD,EAAY;AAClE,YAAMsB,cAAc,EAAE7B,MAAM,iBAAEI,SAAF,CAAYG,OAAOP,IAAnB,CAAR,EAAkCE,MAAM,iBAAEE,SAAF,CAAYG,OAAOL,IAAnB,CAAxC,EAApB;AACA,qBAAGe,aAAH,CAAiB,eAAKtB,IAAL,CAAUuB,SAAV,EAAqB,iBAAEY,SAAF,CAAYvB,OAAOP,IAAnB,IAA2B,OAAhD,CAAjB,EAA2ES,KAAKC,SAAL,CAAemB,WAAf,EAA4B,IAA5B,EAAkC,CAAlC,CAA3E;AACA,qBAAGZ,aAAH,CAAiB,eAAKtB,IAAL,CAAUuB,SAAV,EAAqB,iBAAEY,SAAF,CAAYvB,OAAOP,IAAnB,IAA2B,KAAhD,CAAjB,EAAyEqB,UAAzE;AACA,eAAKlC,MAAL,CAAYqB,IAAZ,CAAiB,4BAAjB;AACD,OALD;AAMD","file":"init.js","sourcesContent":["import fs from 'fs';\nimport path from 'path';\n\nimport colors from 'colors/safe';\nimport _ from 'lodash';\nimport inquirer from 'inquirer';\n\nimport { abstractedValidator } from '../utils';\n\nconst VERSION = 1;\n\nexport default class {\n\n  constructor({ logger, networking, interactive = false }) {\n    this.logger = logger;\n    this.networking = networking;\n    this.interactive = interactive;\n    this.blockManifestFile = 'block.json';\n  }\n\n  createBlock({ folderPath }) {\n    // disable this method for non interactive use.\n    if (!this.interactive) {\n      this.logger.error('#createBlock not supported for non-interactive mode');\n      return;\n    }\n\n    let existingManifest = null;\n\n    try {\n      existingManifest = fs.readFileSync(path.join(folderPath, this.blockManifestFile), 'utf-8');\n    } catch (e) {\n      // silence\n    }\n\n    if (existingManifest !== null) {\n      this.logger.error(colors.red(this.blockManifestFile + 'already exists. aborting initalization'));\n      return;\n    }\n\n    const inputParams = [\n      {\n        field: null,\n        name: 'name',\n        question: 'Please enter the BLOCK name',\n        type: 'input',\n        default: _.kebabCase(path.basename(folderPath))\n      },\n      {\n        field: null,\n        name: 'description',\n        question: 'Please enter the BLOCK description',\n        type: 'input'\n      },\n      {\n        field: null,\n        name: 'license',\n        question: 'Please enter the license type',\n        type: 'input',\n        default: 'ISC'\n      },\n      {\n        field: null,\n        name: 'version',\n        question: 'Please enter the inital version',\n        type: 'input',\n        default: '1.0.0'\n      }\n    ];\n\n    abstractedValidator(inputParams, this.interactive).then((fields) => {\n      this.logger.info('About to create the following ' + this.blockManifestFile + ' file \\n' + JSON.stringify(fields, null, '\\t'));\n\n      inquirer.prompt({ type: 'boolean', name: 'okayToWrite', default: true, message: 'Good to write to file system?' }).then((result) => {\n        if (result.okayToWrite) {\n          fields.dependencies = {};\n          fields.version = VERSION;\n          fs.writeFileSync(path.join(folderPath, this.blockManifestFile), JSON.stringify(fields, null, 4));\n          this.logger.info(this.blockManifestFile + 'file created at: ' + path.join(folderPath, this.blockManifestFile));\n        }\n      });\n    });\n  }\n\n  createEventHandler({ folderPath }) {\n    const srcFolder = path.join(folderPath, 'src');\n    const templateFolder = path.join(__dirname, '../../templates');\n    const jsTemplate = fs.readFileSync(path.join(templateFolder, 'eh.js'), 'utf8');\n\n    // disable this method for non interactive use.\n    if (!this.interactive) {\n      this.logger.error('#createEventHandler not supported for non-interactive mode');\n      return;\n    }\n\n    // check if src folder exists and create it if it does not.\n    try {\n      fs.statSync(srcFolder);\n    } catch (e) {\n      fs.mkdirSync(srcFolder);\n    }\n\n    const inputParams = [\n      {\n        field: null,\n        name: 'name',\n        question: 'Please enter the Event Handler name',\n        type: 'input',\n        validate: (input) => { return (input !== '' && _.trim(input).length > 0); }\n      },\n      {\n        field: null,\n        name: 'type',\n        question: 'Please choose the event handler type',\n        type: 'list',\n        choices: ['Before Publish', 'After Publish', 'After Presence']\n      }\n    ];\n\n    abstractedValidator(inputParams, this.interactive).then((fields) => {\n      const handlerJSON = { name: _.kebabCase(fields.name), type: _.kebabCase(fields.type) };\n      fs.writeFileSync(path.join(srcFolder, _.lowerCase(fields.name) + '.json'), JSON.stringify(handlerJSON, null, 4));\n      fs.writeFileSync(path.join(srcFolder, _.lowerCase(fields.name) + '.js'), jsTemplate);\n      this.logger.info('Created new event handler.');\n    });\n  }\n\n}\n"]}