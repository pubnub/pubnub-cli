{"version":3,"sources":["networking.js"],"names":["request","require","colors","process","env","NODE_TLS_REJECT_UNAUTHORIZED","endpoint","logLevel","newSessionToken","sessionToken","method","url","opts","callback","join","json","headers","Authorization","pendingNetworking","JSON","stringify","state","console","log","gray","err","response","body","statusCode","red","errorMessage","statusMessage","error","errHandle","_extractError","message","green","text","ownerId","qs","owner_id","keyId","blockId","blockPayload","form","eventHandlerPayload","eventHandlerId","email","password"],"mappings":"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","file":"networking.js","sourcesContent":["const request = require('request');\nconst colors = require('colors/safe');\n\n// this is a fix for bad SSL cert on portal gold\nprocess.env.NODE_TLS_REJECT_UNAUTHORIZED = 0;\n\nexport default class {\n\n  constructor({ endpoint, logLevel }) {\n    this.logLevel = logLevel;\n    this.endpoint = endpoint || 'https://portal1.gold.aws-pdx-3.ps.pn';\n  }\n\n  updateSessionToken(newSessionToken) {\n    this.sessionToken = newSessionToken;\n  }\n\n  request(method, url, opts, callback) {\n    opts = opts || {};\n\n    opts.url = this.endpoint + '/' + url.join('/');\n    opts.method = method;\n\n    opts.json = true;\n    opts.headers = opts.headers || {};\n    opts.headers.Authorization = 'Basic cHVibnViLWJldGE6YmxvY2tzMjAxNg===';\n\n    if (this.sessionToken) {\n      opts.headers['X-Session-Token'] = this.sessionToken;\n    }\n\n    if (this.logLevel === 'debug') {\n      const pendingNetworking = JSON.stringify({ state: 'pending', method, url, opts }, null, 4);\n      console.log('\\n\\n', colors.gray(pendingNetworking), '\\n\\n'); // eslint-disable-line no-console\n    }\n\n    request(opts, (err, response, body) => {\n      if (response.statusCode !== 200 || err) {\n        if (this.logLevel === 'debug') {\n          const pendingNetworking = JSON.stringify({ state: 'failed', method, url, opts, err, response, body }, null, 4);\n          console.log('\\n\\n', colors.red(pendingNetworking), '\\n\\n'); // eslint-disable-line no-console\n        }\n\n        const errorMessage = response.statusMessage || body.error || '';\n        this.errHandle('Server replied with code ' + response.statusCode + ' ' + errorMessage);\n        callback(this._extractError(err) || body.message || body);\n      } else {\n        if (this.logLevel === 'debug') {\n          const pendingNetworking = JSON.stringify({ state: 'success', method, url, opts, err, response }, null, 4);\n          console.log('\\n\\n', colors.green(pendingNetworking), '\\n\\n'); // eslint-disable-line no-console\n        }\n\n        callback(null, body);\n      }\n    });\n  }\n\n  errHandle(text) {\n    if (this.logLevel === 'debug') {\n      console.error(colors.red('API Error: ' + text)); // eslint-disable-line no-console\n    }\n  }\n\n  getApps({ ownerId }, callback) {\n    if (!ownerId) return callback('missing ownerId');\n    if (!this.sessionToken) return callback('missing sessionToken');\n\n    const opts = { qs: { owner_id: ownerId } };\n    this.request('get', ['api', 'apps'], opts, callback);\n  }\n\n  getBlocks({ keyId }, callback) {\n    if (!keyId) return callback('missing keyId');\n    if (!this.sessionToken) return callback('missing sessionToken');\n\n    this.request('get', ['api', 'v1', 'blocks', 'key', keyId, 'block'], {}, callback);\n  }\n\n  startBlock({ keyId, blockId }, callback) {\n    if (!keyId) return callback('missing keyId');\n    if (!blockId) return callback('missing blockId');\n    if (!this.sessionToken) return callback('missing sessionToken');\n\n    this.request('post', ['api', 'v1', 'blocks', 'key', keyId, 'block', blockId, 'start'], {}, callback);\n  }\n\n  stopBlock({ keyId, blockId }, callback) {\n    if (!keyId) return callback('missing keyId');\n    if (!blockId) return callback('missing blockId');\n    if (!this.sessionToken) return callback('missing sessionToken');\n\n    this.request('post', ['api', 'v1', 'blocks', 'key', keyId, 'block', blockId, 'stop'], {}, callback);\n  }\n\n  createBlock({ keyId, blockPayload }, callback) {\n    if (!keyId) return callback('missing keyId');\n    if (!blockPayload) return callback('missing blockPayload');\n    if (!this.sessionToken) return callback('missing sessionToken');\n\n    const opts = { form: blockPayload };\n    this.request('post', ['api', 'v1', 'blocks', 'key', keyId, 'block'], opts, callback);\n  }\n\n  updateBlock({ keyId, blockId, blockPayload }, callback) {\n    if (!keyId) return callback('missing keyId');\n    if (!blockId) return callback('missing blockId');\n    if (!blockPayload) return callback('missing blockPayload');\n    if (!this.sessionToken) return callback('missing sessionToken');\n\n    const opts = { form: blockPayload };\n    this.request('put', ['api', 'v1', 'blocks', 'key', keyId, 'block', blockId], opts, callback);\n  }\n\n  createEventHandler({ keyId, eventHandlerPayload }, callback) {\n    if (!keyId) return callback('missing keyId');\n    if (!eventHandlerPayload) return callback('missing eventHandlerPayload');\n    if (!this.sessionToken) return callback('missing sessionToken');\n\n    const opts = { form: eventHandlerPayload };\n    this.request('post', ['api', 'v1', 'blocks', 'key', keyId, 'event_handler'], opts, callback);\n  }\n\n  updateEventHandler({ keyId, eventHandlerId, eventHandlerPayload }, callback) {\n    if (!keyId) return callback('missing keyId');\n    if (!eventHandlerId) return callback('missing eventHandlerId');\n    if (!eventHandlerPayload) return callback('missing eventHandlerPayload');\n    if (!this.sessionToken) return callback('missing sessionToken');\n\n    const opts = { form: eventHandlerPayload };\n    this.request('put', ['api', 'v1', 'blocks', 'key', keyId, 'event_handler', eventHandlerId], opts, callback);\n  }\n\n  createLoginToken({ email, password }, callback) {\n    if (!email) return callback('missing email');\n    if (!password) return callback('missing password');\n\n    const opts = { form: { email, password } };\n    this.request('post', ['api', 'me'], opts, callback);\n  }\n\n  _extractError(err, body) {\n    if (body && body.error) {\n      return body.error;\n    } else if (err) {\n      return err;\n    }\n  }\n}\n"],"sourceRoot":"/source/"}