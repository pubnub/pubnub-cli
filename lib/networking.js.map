{"version":3,"sources":["networking.js"],"names":["request","require","colors","process","env","NODE_TLS_REJECT_UNAUTHORIZED","options","endpoint","session","method","url","opts","holla","errHandle","join","json","headers","Authorization","token","clog","red","yellow","err","response","body","statusCode","errorMessage","statusMessage","error","message","text","debug","console","input","log","callback","ownerId","qs","owner_id","keyId","blockId","blockPayload","form","eventHandlerPayload","eventHandlerId","email","password","createLoginToken","result"],"mappings":"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","file":"networking.js","sourcesContent":["const request = require('request');\nconst colors = require('colors');\n\n// this is a fix for bad SSL cert on portal gold\nprocess.env.NODE_TLS_REJECT_UNAUTHORIZED = 0;\n\nexport default class {\n\n  constructor(options) {\n    this.options = options;\n    this.endpoint = options.endpoint || 'https://portal1.gold.aws-pdx-3.ps.pn';\n    this.session = false;\n  }\n\n  request(method, url, opts, holla) {\n    if (url[1] !== 'me' && !this.session) {\n      return this.errHandle('Authorize with init() first.');\n    }\n\n    opts = opts || {};\n\n    opts.url = this.endpoint + '/' + url.join('/');\n    opts.method = method;\n\n    opts.json = true;\n    opts.headers = opts.headers || {};\n    opts.headers.Authorization = 'Basic cHVibnViLWJldGE6YmxvY2tzMjAxNg===';\n\n    if (this.session) {\n      opts.headers['X-Session-Token'] = this.session.token;\n    }\n\n    // clog('-- URL:'.yellow);\n    this.clog(opts.method.red + ' ' + opts.url);\n    this.clog('-- opts:'.yellow);\n    this.clog(opts);\n\n    request(opts, (err, response, body) => {\n      if (response.statusCode !== 200) {\n        const errorMessage = response.statusMessage || body.error || '';\n        this.errHandle('Server replied with code ' + response.statusCode + ' ' + errorMessage);\n        holla(err || body.message || body);\n      } else {\n        holla(err, body);\n      }\n    });\n  }\n\n  errHandle(text) {\n    if (this.options.debug) {\n      console.error(colors.red('API Error: ' + text)); // eslint-disable-line no-console\n    }\n  }\n\n  clog(input) {\n    if (this.options.debug) {\n      if (typeof input === 'object') {\n        console.log(input); // eslint-disable-line no-console\n      } else {\n        console.log('API:'.yellow, input); // eslint-disable-line no-console\n      }\n    }\n  }\n\n  getApps({ ownerId }, callback) {\n    if (!ownerId) return callback('missing ownerId');\n\n    const opts = { qs: { owner_id: ownerId } };\n    this.request('get', ['api', 'apps'], opts, callback);\n  }\n\n  getBlocks({ keyId }, callback) {\n    if (!keyId) return callback('missing keyId');\n\n    this.request('get', ['api', 'v1', 'blocks', 'key', keyId, 'block'], {}, callback);\n  }\n\n  startBlock({ keyId, blockId }, callback) {\n    if (!keyId) return callback('missing keyId');\n    if (!blockId) return callback('missing blockId');\n\n    this.request('post', ['api', 'v1', 'blocks', 'key', keyId, 'block', blockId, 'start'], {}, callback);\n  }\n\n  stopBlock({ keyId, blockId }, callback) {\n    if (!keyId) return callback('missing keyId');\n    if (!blockId) return callback('missing blockId');\n\n    this.request('post', ['api', 'v1', 'blocks', 'key', keyId, 'block', blockId, 'stop'], {}, callback);\n  }\n\n  createBlock({ keyId, blockPayload }, callback) {\n    if (!keyId) return callback('missing keyId');\n    if (!blockPayload) return callback('missing blockPayload');\n\n    const opts = { form: blockPayload };\n    this.request('post', ['api', 'v1', 'blocks', 'key', keyId, 'block'], opts, callback);\n  }\n\n  updateBlock({ keyId, blockId, blockPayload }, callback) {\n    if (!keyId) return callback('missing keyId');\n    if (!blockId) return callback('missing blockId');\n    if (!blockPayload) return callback('missing blockPayload');\n\n    const opts = { form: blockPayload };\n    this.request('put', ['api', 'v1', 'blocks', 'key', keyId, 'block', blockId], opts, callback);\n  }\n\n  createEventHandler({ keyId, eventHandlerPayload }, callback) {\n    if (!keyId) return callback('missing keyId');\n    if (!eventHandlerPayload) return callback('missing eventHandlerPayload');\n\n    const opts = { form: eventHandlerPayload };\n    this.request('post', ['api', 'v1', 'blocks', 'key', keyId, 'event_handler'], opts, callback);\n  }\n\n  updateEventHandler({ keyId, eventHandlerId, eventHandlerPayload }, callback) {\n    if (!keyId) return callback('missing keyId');\n    if (!eventHandlerId) return callback('missing eventHandlerId');\n    if (!eventHandlerPayload) return callback('missing eventHandlerPayload');\n\n    const opts = { form: eventHandlerPayload };\n    this.request('put', ['api', 'v1', 'blocks', 'key', keyId, 'event_handler', eventHandlerId], opts, callback);\n  }\n\n  createLoginToken({ email, password }, callback) {\n    if (!email) return callback('missing email');\n    if (!password) return callback('missing password');\n\n    const opts = { form: { email, password } };\n    this.request('post', ['api', 'me'], opts, callback);\n  }\n\n  init(input, holla) {\n    this.createLoginToken({ email: input.email, password: input.password }, (err, body) => {\n      if (body && body.error) {\n        holla(body.error);\n      } else if (err) {\n        holla(err.error);\n      } else {\n        this.session = body.result;\n        holla(null, body);\n      }\n    });\n  }\n}\n"],"sourceRoot":"/source/"}