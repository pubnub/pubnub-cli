{"version":3,"sources":["networking.js"],"names":["request","require","colors","process","env","NODE_TLS_REJECT_UNAUTHORIZED","Client","options","self","errHandle","text","debug","console","error","red","clog","input","log","yellow","endpoint","session","method","url","opts","holla","join","json","headers","Authorization","token","err","response","body","statusCode","statusMessage","message","getApps","callback","ownerId","qs","owner_id","getBlocks","keyId","startBlock","blockId","stopBlock","createBlock","blockPayload","form","updateBlock","createEventHandler","eventHandlerPayload","updateEventHandler","eventHandlerId","init","email","password","result","module","exports","data"],"mappings":"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","file":"networking.js","sourcesContent":["// Blocks-API Client\n\n// https://gist.github.com/parasyte/bc041e79b0fc61801eaf36c42fc7b06a\n// https://github.com/pubnub/pubnub-portal-client/blob/blocks-integration/blocks-integration-overview.md\n// https://sites.google.com/a/pubnub.com/product/engineering/portal/apis-for-provisioning-keys\n\nvar request = require('request');\nvar colors = require('colors');\n\n// this is a fix for bad SSL cert on portal gold\nprocess.env.NODE_TLS_REJECT_UNAUTHORIZED = 0;\n\nvar Client = function (options) {\n\n  var self = this;\n\n  var errHandle = function (text) {\n    if (options.debug) {\n      console.error(colors.red('API Error: ' + text)); // eslint-disable-line no-console\n    }\n  };\n\n  var clog = function (input) {\n\n    if (options.debug) {\n      if (typeof input === 'object') {\n        console.log(input); // eslint-disable-line no-console\n      } else {\n        console.log('API:'.yellow, input); // eslint-disable-line no-console\n      }\n    }\n  };\n\n  options = options || {};\n\n  self.endpoint = options.endpoint || 'https://portal1.gold.aws-pdx-3.ps.pn';\n\n  self.session = false;\n\n  self.request = function (method, url, opts, holla) {\n    if (url[1] !== 'me' && !self.session) {\n      return errHandle('Authorize with init() first.');\n    }\n\n    opts = opts || {};\n\n    opts.url = self.endpoint + '/' + url.join('/');\n    opts.method = method;\n\n    opts.json = true;\n    opts.headers = opts.headers || {};\n    opts.headers.Authorization = 'Basic cHVibnViLWJldGE6YmxvY2tzMjAxNg===';\n\n    if (self.session) {\n      opts.headers['X-Session-Token'] = self.session.token;\n    }\n\n    // clog('-- URL:'.yellow);\n    clog(opts.method.red + ' ' + opts.url);\n    clog('-- opts:'.yellow);\n    clog(opts);\n\n    request(opts, function (err, response, body) {\n      if (response.statusCode !== 200) {\n        errHandle('Server replied with code ' + response.statusCode + ' ' + response.statusMessage || body.error || '');\n        holla(err || body.message || body);\n      } else {\n        holla(err, body);\n      }\n    });\n  };\n\n  self.getApps = function (input, callback) {\n    var ownerId = input.ownerId;\n\n    if (!ownerId) return callback('missing ownerId');\n\n    var opts = { qs: { owner_id: ownerId } };\n    this.request('get', ['api', 'apps'], opts, callback);\n  };\n\n  self.getBlocks = function (input, callback) {\n    var keyId = input.keyId;\n\n    if (!keyId) return callback('missing keyId');\n\n    this.request('get', ['api', 'v1', 'blocks', 'key', keyId, 'block'], {}, callback);\n  };\n\n  self.startBlock = function (input, callback) {\n    var keyId = input.keyId;\n    var blockId = input.blockId;\n\n    if (!keyId) return callback('missing keyId');\n    if (!blockId) return callback('missing blockId');\n\n    this.request('post', ['api', 'v1', 'blocks', 'key', keyId, 'block', blockId, 'start'], {}, callback);\n  };\n\n  self.stopBlock = function (input, callback) {\n    var keyId = input.keyId;\n    var blockId = input.blockId;\n\n    if (!keyId) return callback('missing keyId');\n    if (!blockId) return callback('missing blockId');\n\n    this.request('post', ['api', 'v1', 'blocks', 'key', keyId, 'block', blockId, 'stop'], {}, callback);\n  };\n\n  self.createBlock = function (input, callback) {\n    var keyId = input.keyId;\n    var blockPayload = input.blockPayload;\n\n    if (!keyId) return callback('missing keyId');\n    if (!blockPayload) return callback('missing blockPayload');\n\n    var opts = { form: blockPayload };\n    this.request('post', ['api', 'v1', 'blocks', 'key', keyId, 'block'], opts, callback);\n  };\n\n  self.updateBlock = function (input, callback) {\n    var keyId = input.keyId;\n    var blockId = input.blockId;\n    var blockPayload = input.blockPayload;\n\n    if (!keyId) return callback('missing keyId');\n    if (!blockId) return callback('missing blockId');\n    if (!blockPayload) return callback('missing blockPayload');\n\n    var opts = { form: blockPayload };\n    this.request('put', ['api', 'v1', 'blocks', 'key', keyId, 'block', blockId], opts, callback);\n  };\n\n  self.createEventHandler = function (input, callback) {\n    var keyId = input.keyId;\n    var eventHandlerPayload = input.eventHandlerPayload;\n\n    if (!keyId) return callback('missing keyId');\n    if (!eventHandlerPayload) return callback('missing eventHandlerPayload');\n\n    var opts = { form: eventHandlerPayload };\n    this.request('post', ['api', 'v1', 'blocks', 'key', keyId, 'event_handler'], opts, callback);\n  };\n\n  self.updateEventHandler = function (input, callback) {\n    var keyId = input.keyId;\n    var eventHandlerId = input.eventHandlerId;\n    var eventHandlerPayload = input.eventHandlerPayload;\n\n    if (!keyId) return callback('missing keyId');\n    if (!eventHandlerId) return callback('missing eventHandlerId');\n    if (!eventHandlerPayload) return callback('missing eventHandlerPayload');\n\n    var opts = { form: eventHandlerPayload };\n    this.request('put', ['api', 'v1', 'blocks', 'key', keyId, 'event_handler', eventHandlerId], opts, callback);\n  };\n\n  self.init = function (input, holla) {\n    self.request('post', ['api', 'me'], {\n      form: {\n        email: input.email || errHandle('No Email Supplied'),\n        password: input.password || errHandle('No Password Supplied')\n      }\n    }, function (err, body) {\n      if (body && body.error) {\n        holla(body.error);\n      } else if (err) {\n        holla(err.error);\n      } else {\n        self.session = body.result;\n        holla(null, body);\n      }\n\n    });\n\n  };\n\n  return self;\n\n};\n\nmodule.exports = function (data) {\n  return new Client(data);\n};\n"],"sourceRoot":"/source/"}